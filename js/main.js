(function(){"use strict";const MATCH="js-match";const FLIP="js-flip";const FACE_DOWN="face down";const GAME_COMPLETE="js-game-complete";const STORAGE_KEY="mgdata";const data={};let displayTimeout;const memoryGame=document.querySelector("#memory-game");const memoryGrid=memoryGame.querySelector("#memory-grid");const result=memoryGame.querySelector("#card-flips");function initData(state){Object.assign(data,state||{cards:{},flips:0})}function initCardsFromData(){for(const cardKey in data.cards){const cardElem=memoryGrid.querySelector("[data-card-id="+cardKey+"]");cardElem.className=data.cards[cardKey];if(cardElem.classList.contains(FLIP)||cardElem.classList.contains(MATCH)){cardElem.setAttribute("aria-label",cardElem.dataset.symbol)}memoryGrid.appendChild(cardElem)}}function initCardShuffle(){[...memoryGrid.querySelectorAll(".card")].sort((function(){return.5-Math.random()})).forEach((function(elem){resetCard(elem);memoryGrid.appendChild(elem)}))}function flipCard(cardElem){data.flips+=1;cardElem.classList.add(FLIP);cardElem.setAttribute("aria-label",cardElem.dataset.symbol)}function deselectCard(cardElem){cardElem.classList.remove(FLIP);cardElem.setAttribute("aria-label",FACE_DOWN)}function matchedCard(cardElem){cardElem.classList.remove(FLIP);cardElem.classList.add(MATCH)}function resetCard(cardElem){deselectCard(cardElem);cardElem.classList.remove(MATCH)}function updateCardData(cardElem){data.cards[cardElem.dataset.cardId]=cardElem.className;storeState()}function matchingCards(cardElems){cardElems.forEach((function(cardElem){matchedCard(cardElem)}))}function nonmatchingCards(cardElems){setTimeout((function(){cardElems.forEach((function(cardElem){deselectCard(cardElem)}))}),1e3)}function isLastMatchingPair(){return memoryGrid.querySelectorAll("."+MATCH).length===16}function matchCards(cardElems){if(cardElems[0].dataset.symbol===cardElems[1].dataset.symbol){matchingCards(cardElems);if(isLastMatchingPair()){displayCongrats()}}else{nonmatchingCards(cardElems)}}function displayGameCompleted(){memoryGame.classList.add(GAME_COMPLETE);result.textContent=`${data.flips} card flips`;memoryGrid.classList.add("blur")}function hideGameCompleted(){memoryGrid.classList.remove("blur");memoryGame.classList.remove(GAME_COMPLETE)}function displayCongrats(){displayTimeout=setTimeout((function(){displayGameCompleted();setTimeout(hideGameCompleted,4e3)}),500)}function newGame(){clearTimeout(displayTimeout);hideGameCompleted();initData();initCardShuffle()}function cardClick(cardElem){if(cardElem.classList.contains(FLIP)||cardElem.classList.contains(MATCH)){return}const flippedCards=memoryGrid.querySelectorAll("."+FLIP);if(flippedCards.length===2){return}flipCard(cardElem);if(flippedCards.length>0){matchCards([cardElem,flippedCards[0]])}}function storeState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data))}const observer=new MutationObserver((function(mutations){for(const mutation of mutations){if(mutation.type==="attributes"&&mutation.target.dataset.cardId){updateCardData(mutation.target)}}}));observer.observe(memoryGame,{attributes:true,subtree:true});document.documentElement.addEventListener("click",(function(event){if(event.target.matches(".new-game")){event.preventDefault();newGame()}if(event.target.matches(".card")){event.preventDefault();cardClick(event.target)}}),false);(function(){const storedData=JSON.parse(localStorage.getItem(STORAGE_KEY));initData(storedData);if(storedData){initCardsFromData()}else{initCardShuffle()}})()})();